---
title: '[React] æ­£ç¢ºåœ°ä½¿ç”¨ State èˆ‡ useState Hook'
excerpt: 'æœ¬æ–‡ä»‹ç´¹ React ä¸­ State çš„æ¦‚å¿µï¼ŒåŒ…å« useState Hookã€Snapshotã€Lazy State Initialization ç­‰è§€å¿µï¼Œçœ‹ä¼¼ç°¡å–®çš„ç‹€æ…‹ï¼Œå…¶å¯¦æœ‰ä¸€äº›ç´°ç¯€è§€å¿µæ˜¯åˆå­¸æ™‚å®¹æ˜“å¿½ç•¥çš„ã€‚'
tags: ['React']
date: '2021-09-03'
---

## åˆå§‹åŒ–èˆ‡é‡æ–°æ¸²æŸ“

> [useState - React å®˜æ–¹æ–‡ä»¶](https://zh-hant.reactjs.org/docs/hooks-reference.html#usestate)

- åˆå§‹åŒ– (Initialization)ï¼šState åªæœƒåœ¨ç¬¬ä¸€æ¬¡è¼‰å…¥æ™‚åˆå§‹åŒ–ï¼Œé™¤éž DOM ç§»é™¤ï¼Œå¦å‰‡ `useState` ç®¡ç†çš„ State éƒ½ä¸æœƒé‡æ–°åˆå§‹åŒ–
- é‡æ–°æ¸²æŸ“ (Re-rendering)ï¼šæŸç‹€æ…‹æ”¹è®Šæœƒå°Žè‡´å…ƒä»¶é‡æ–°ç¹ªè£½ï¼Œä¸éŽåªæœƒæ›´æ”¹è©²ä¸€ç‹€æ…‹ï¼Œå…¶ä»–ç‹€æ…‹ä¸æœƒé€²è¡Œåˆå§‹åŒ–ï¼ˆä½†æ˜¯æœƒåŸ·è¡Œåˆå§‹åŒ–è¡Œç‚ºï¼Œç®—æ˜¯å°åœ°é›·ï¼Œæ–‡ç« æœ€å¾Œæœƒæåˆ°é€™ä¸€é»žï¼‰

å¦‚æžœæ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼ŒState çš„å€¼æœƒæ˜¯ Initial Stateï¼Œä½†å¦‚æžœæ˜¯å¾ŒçºŒçš„ Re-renderï¼ŒInitial State å°‡ä¸æœƒè¢«ä½¿ç”¨ï¼ŒState æœƒç¶­æŒæœ€è¿‘ä¸€æ¬¡æ›´æ–°çš„ State å€¼ã€‚

é€™æ˜¯ React æ©Ÿåˆ¶ä¸‹æ‰€ä¿è­‰çš„ï¼Œä¹Ÿæ˜¯ç‚ºä»€éº¼ `useEffect` ä¸å¿…æŠŠ State æ”¾å…¥ Dependencies çš„åŽŸå› ã€‚

## æ›´æ”¹ç‹€æ…‹

é€²è¡Œ `setState` æ™‚ï¼ŒReact ä¸¦ä¸æœƒé¦¬ä¸Šæ›´æ”¹ç‹€æ…‹ï¼Œè€Œæ˜¯æœƒé€²å…¥æŽ’ç¨‹ï¼Œä¸¦ä¸”å„ªå…ˆåŸ·è¡Œæ›´é‡è¦çš„å·¥ä½œã€‚

ä¸éŽ React é‚„æ˜¯æœƒç¢ºä¿æˆ‘å€‘æ”¹è®Š State çš„é †åºæ˜¯æ­£ç¢ºçš„ï¼Œä¾‹å¦‚ä»¥ä¸‹æœ‰å¤šå€‹ `setState`ï¼ŒReact æœƒæŒ‰ç…§æŽ’ç¨‹é †åºåŸ·è¡Œç‹€æ…‹æ”¹è®Šï¼Œå› æ­¤ State å°±æœƒå¾—åˆ° Bookã€‚

```jsx
const [state, setState] = useState('DVD');

setState('Pencil');
setState('Book'); // æœ€å¾Œçš„ç‹€æ…‹æœƒè®Šæˆ Book
```

## å–å¾—ç‹€æ…‹å¿«ç…§

æœ‰æ™‚å€™æˆ‘å€‘éœ€è¦é¦¬ä¸Šå–å¾—æ”¹è®Šçš„çµæžœï¼Œæ–¹ä¾¿åŽ»åšä¸€äº›æ‡‰ç”¨æˆ–è¨ˆç®—ã€‚é€™æ™‚å€™æˆ‘å€‘å¯ä»¥é€éŽã€Œå‡½å¼ã€çš„å½¢å¼ï¼Œè®“ç‹€æ…‹æ›´æ–°å¯ä»¥ä¾è³´æ–¼å…ˆå‰çš„ç‹€æ…‹å¿«ç…§ (Snapshot)ã€‚

```jsx
// ðŸ‘‡ Updating State That Depends On The Previous State.
// Safer way: Ensure the Latest state snapshot (If it depends on the previous state)
setUserInput((prevState) => {
  return { ...prevState, enteredTitle: event.target.value };
});

// Complex state: arrays
setUserInput((prevArray) => {
  return [...prevArray, { enteredTitle: event.target.value }];
});

// Complex state: objects
setUserInput((prevObject) => {
  return { ...prevObject, enteredTitle: event.target.value };
});
```

é€™æ¨£æˆ‘å€‘å°±èƒ½å¾—åˆ°åŸºæ–¼ç‹€æ…‹å¿«ç…§ (Snapshot) çš„æ–°ç‹€æ…‹ï¼Œè€Œä¸æ˜¯æ°¸é éƒ½åªæœƒæ‹¿åˆ°æœ€æ–°çš„é‚£ä¸€å€‹ç‹€æ…‹ã€‚

ç‰¹åˆ¥æ˜¯ç•¶æ–°ç‹€æ…‹çš„æ”¹è®Šï¼Œæ˜¯ä¾è³´æ–¼å‰ä¸€å€‹ç‹€æ…‹çš„æ™‚å€™ï¼Œå°±è¦ç”¨é€™ç¨® Functional Return çš„å½¢å¼ï¼Œä»¥å–å¾—æœ€æ–°çš„ç‹€æ…‹ã€‚

é™¤äº†ä¸Šé¢é€™å€‹æ–¹æ³•ï¼Œæˆ‘å€‘ä¹Ÿå¯ä»¥å€ŸåŠ© `useEffect` ä¾†å®Œæˆé€™å€‹æ•ˆæžœã€‚`useEffect` å¯ä»¥ç›£è½ Dependencies è£¡é¢çš„ State æœ‰æ²’æœ‰æ”¹è®Šï¼Œå¦‚æžœæ”¹è®Šå°±åŸ·è¡Œ `setState`ï¼Œå› æ­¤ä¹Ÿä¸æœƒéŒ¯éŽç‹€æ…‹æ”¹è®Šï¼Œèƒ½å¤ ç¢ºä¿å–å¾—æœ€æ–°çš„ç‹€æ…‹ã€‚

ä¹Ÿå› æ­¤ï¼Œåœ¨ `useEffect` è£¡ä½¿ç”¨çš„ `setState` çš„æ™‚å€™ï¼Œå³ä½¿ä¸æ˜¯å¯«æˆå‡½å¼çš„å½¢å¼ï¼Œä¹Ÿæœƒå³æ™‚æ›´æ–°ç‹€æ…‹å–”ï¼

## Lazy State Initialization

ç•¶ä¸€å€‹å…ƒä»¶è£¡çš„ç‹€æ…‹è¢«æ”¹è®Šæ™‚ï¼Œå°±æœƒé‡æ–°æ¸²æŸ“é‚£å€‹å…ƒä»¶ï¼Œè€Œåœ¨åš re-render æ™‚ `useState` çš„ initial value é›–ç„¶æ˜¯æ²’ç”¨çš„ï¼Œä½†æ˜¯å…¶å¯¦æ¯æ¬¡ re-render æ™‚é‚„æ˜¯æœƒå†è·‘ä¸€æ¬¡ initial valueã€‚

è½èµ·ä¾†å½±éŸ¿ä¸å¤§æ˜¯å—Žï¼Ÿç•¢ç«Ÿæ²’å½±éŸ¿åˆ°ç•«é¢å‘ˆç¾å˜›ï¼Ÿ

å¦‚æžœæ˜¯åœ¨ä»£åƒ¹å¾ˆä½Žçš„æƒ…æ³ä¸‹å¯èƒ½æ²’å·®ï¼Œåƒæ˜¯æ¯æ¬¡ re-render éƒ½é‡æ–°è·‘ä¸€æ¬¡ `console.log` æˆ–è¨±ç„¡æ‰€è¬‚ã€‚

```jsx
const [state, setState] = React.useState(console.log('State initialization'));
```

ä½†æ˜¯å¦‚æžœåˆå§‹ State æ˜¯ä¸€äº›éœ€è¦è¤‡é›œé‚è¼¯è¨ˆç®—ã€æ•ˆèƒ½è€—è²»è¼ƒé«˜çš„ç‹€æ…‹æ™‚ï¼Œåƒæ˜¯å¾ž Local Storage è®€å–å€¼ï¼Œé‚£å°±å¿…é ˆè€ƒé‡åˆ°æ•ˆèƒ½å•é¡Œäº†ã€‚

```jsx
const [state, setState] = React.useState(
  JSON.parse(localStorage.getItem('notes')) || [],
);
```

é€™æ™‚å€™æˆ‘å€‘å¯ä»¥é‹ç”¨ `useState` çš„ä¸€å€‹ç‰¹æ€§ï¼Œå¯ä»¥æŠŠå®ƒæƒ³æˆæ˜¯ä¸€å€‹æ‡¶æƒ°çš„åˆå§‹ç‹€æ…‹ï¼Œç•¶æˆ‘å€‘æƒ³è¦é¿å…åŸ·è¡Œ Initialize æ™‚ï¼Œå°±å¯ä»¥ç”¨é€™å€‹ Lazy Initialization çš„æ–¹æ³•åˆå§‹åŒ– Stateã€‚

å¯«æ³•å°±æ˜¯åœ¨ `useState` åŽŸæœ¬å‚³å…¥ value çš„åœ°æ–¹ï¼Œæ”¹ç‚ºå‚³å…¥ Function ä¾† return åˆå§‹å€¼ã€‚ç•¶å‚³å…¥çš„æ˜¯ä¸€å€‹ Function æ™‚ï¼Œé€™å€‹ Initial Function å°±åªæœƒåœ¨åˆå§‹ Render æ™‚è¢«èª¿ç”¨åŸ·è¡Œï¼Œå¾ŒçºŒ Re-rendering æ™‚ä¸æœƒå†åŸ·è¡Œã€‚

> Lazily initialize our `notes` state so it doesn't reach into localStorage on every single re-render of the App component.

```jsx
const [notes, setNotes] = React.useState(
  () => JSON.parse(localStorage.getItem('notes')) || [],
);
```

## Recap

- State
- useState Hook
- Snapshot
- Lazy State Initialization

## References

- [React - The Complete Guide (incl Hooks, React Router, Redux)](https://www.udemy.com/course/react-the-complete-guide-incl-redux/)
